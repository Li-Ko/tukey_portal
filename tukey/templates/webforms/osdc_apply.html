{% extends "base.html" %}

{% load i18n %}

{% block meta_title %}PDC Application{% endblock %}

{% block header %}
<header class="jumbotron subhead">
  <h1>Apply for a PDC Account</h1>
</header>
{% endblock %}

{% block main %}
<div class="span10">
<p>
Please fill out this form to apply for access to the Bionimbus Protected Data Cloud. Once your application is submitted, a member of our team will be in touch regarding your application as soon as possible.
</p>
<p>
To access the PDC, you must have an <a href="https://commons.era.nih.gov/">eRA Commons</a> account and <a href="http://www.ncbi.nlm.nih.gov/projects/gap/cgi-bin/study.cgi?study_id=phs000178.v8.p7">dbGaP access to TCGA</a>.
For more in-depth instructions on getting the right access credentials, please review the following <a href="/static/BionimbusAccessFAQ.pdf">FAQ.</a> If you have any questions about the application process, please contact us at <script type="text/javascript"> document.write('accounts' + '@' + 'opencloudconsortium.org') </script>. Thank you.

</p>
</div>
<div class="span12">
<form action="/apply/" method="post" enctype="multipart/form-data" class="form-horizontal">{% csrf_token %}
  <fieldset>

    <div class="control-group {% if form.eracommons.errors %}error{% endif %}">
      <label class="control-label" for="id_eracommans">eRA Commons Username*</label>
      <div class="controls">
        {{ form.eracommons }}
        {{ form.eppn.as_hidden }}
    	{{ form.method.as_hidden }}
    <span class="help-inline">{{form.eracommons.errors}}</span>
      </div>
    </div>

    <div class="control-group {% if form.first_name.errors %}error{% endif %}">
      <label class="control-label" for="id_first_name">First Name*</label>
      <div class="controls">
        {{ form.first_name }}
        <span class="help-inline">{{form.first_name.errors}}</span>
      </div>
    </div>

    <div class="control-group {% if form.last_name.errors %}error{% endif %}">
      <label class="control-label" for="id_last_name">Last Name*</label>
      <div class="controls">
        {{ form.last_name }}
        <span class="help-inline">{{form.last_name.errors}}</span>
      </div>
    </div>

    <div class="control-group {% if form.email.errors %}error{% endif %}">
      <label class="control-label" for="id_email">E-mail*</label>
      <div class="controls">
        {{ form.email }}
        <span class="help-inline">{{form.email.errors}}</span>
      </div>
    </div>

    <div class="control-group {% if form.organization.errors %}error{% endif %}">
      <label class="control-label" for="id_organization">Organization/University*</label>
      <div class="controls">
        {{ form.organization }}
        <span class="help-inline">{{form.organization.errors}}</span>
      </div>
    </div>

    <div class="control-group {% if form.webpage.errors %}error{% endif %}">
      <label class="control-label" for="id_webpage">Web Page</label>
      <div class="controls">
        {{ form.webpage }}
        <span class="help-inline">{{form.webpage.errors}}</span>
      </div>
    </div>

    <div class="control-group {% if form.phonenumber.errors %}error{% endif %}">
      <label class="control-label" for="id_phonenumber">Phone Number</label>
      <div class="controls">
        {{ form.phonenumber }}
        <span class="help-inline">{{form.phonenumber.errors}}</span>
      </div>
    </div>

    <div class="control-group {% if form.address.errors %}error{% endif %}">
      <label class="control-label" for="id_address">Address</label>
      <div class="controls">
        {{ form.address }}
        <span class="help-inline">{{form.address.errors}}</span>
      </div>
    </div>

    <div class="control-group {% if form.projectname.errors %}error{% endif %}">
      <label class="control-label" for="id_projectname">Project Name*</label>
      <div class="controls">
        {{ form.projectname }}
        <span class="help-inline">{{form.projectname.errors}}</span>
      </div>
    </div>

    <div class="control-group {% if form.projectlead.errors %}error{% endif %}">
      <label class="control-label" for="id_projectlead">Project Lead*</label>
      <div class="controls">
        {{ form.projectlead }}
        <span class="help-inline">{{form.projectlead.errors}}</span>
      </div>
    </div>

    <div class="control-group {% if form.projectlead_email.errors %}error{% endif %}">
      <label class="control-label" for="id_projectlead_email">Project Lead E-mail*</label>
      <div class="controls">
        {{ form.projectlead_email }}
        <span class="help-inline">{{form.projectlead_email.errors}}</span>
      </div>
    </div>

    <div class="control-group {% if form.projectdescr.errors %}error{% endif %}">
      <label class="control-label" for="id_projectdescr">Brief Project Description*</label>
      <div class="controls">
        {{ form.projectdescr }}
        <span class="help-inline">{{form.projectdescr.errors}}</span>
      </div>
    </div>

    <div class="control-group {% if form.sharing.errors %}error{% endif %}">
      <label class="control-label" for="id_sharing">If project requires sharing files or directories,
        please list names of individuals needing access.</label>
      <div class="controls">
        {{ form.sharing }}
        <span class="help-inline">{{ form.sharing.errors }}</span>
      </div>
    </div>

    <div class="control-group cpus {% if form.cpus.errors %}error{% endif %}">
      <label class="control-label" for="id_cpus">Estimate of CPUs required*</label>
      <div class="controls">
        {{ form.cpus }}
        <span class="help-inline">{{ form.cpus.errors }}</span>
      </div>
    </div>

<!-- if requesting 16+, display below -->
    <div class="control-group extra_cpus {% if form.more_cpus.errors %}error{% endif %}">
      <label class="control-label" for="id_more_cpus">Please specify how many CPUs required*</label>
      <div class="controls">
        {{ form.more_cpus }}
        <span class="help-inline">{{ form.more_cpus.errors }}</span>
      </div>
    </div>
<!-- end if 16+-->

    <div class="control-group storage {% if form.storage.errors %}error{% endif %}">
     <label class="control-label" for="id_storage">Estimate of storage required*</label>
     <div class="controls">
       {{ form.storage }}
       <span class="help-inline">{{ form.storage.errors }}</span>
     </div>
    </div>

<!-- If requesting 1+, display below -->
    <div class="control-group extra_storage {% if form.more_storage.errors %}error{% endif %}">
      <label class="control-label" for="id_more_storage">Please specify how much storage required*</label>
      <div class="controls">
        {{ form.more_storage }}
        <span class="help-inline">{{ form.more_storage.errors }}</span>
      </div>
    </div>
<!-- end if 1+ -->

    <div class="control-group {% if form.referral_source.errors %}error{% endif %}">
      <label class="control-label" for="id_referral_source">How did you hear about the Bionimbus PDC?*</label>
      <div class="controls">
        {{ form.referral_source }}
        <span class="help-inline">{{ form.referral_source.errors }}</span>
      </div>
    </div>

    <div class="control-group">
      <div class="controls">
	<button type="submit" class="btn btn-warning">Submit Application</button>
      </div>
    </div>
  </fieldset>
</form>
</div>
{% endblock %}

{% block js %}

{% include "horizon/_scripts.html" %}
<script type="text/javascript">
  $(document).ready(function() {

    function true_toggle(selector, condition){
      if (condition) {
        $(selector).show();
      }
      else {
        $(selector).hide();
      }
    }

    $("#nav-apply").attr('class', 'active');
    $("#id_systems_2").change(function() {
      true_toggle(".extra_occy", this.checked);
      true_toggle(".extra_pubkey", this.checked);
    }).change();

    function displayMoreCPUs() {
      var cpus = $("#id_cpus").val();
      if (cpus == "16plus") {
        $(".extra_cpus").show();
      } else {
        $(".extra_cpus").hide();
      }
    }

    function displayMoreStorage() {
      var storage = $("#id_storage").val();
      if (storage == "1plus") {
        $(".extra_storage").show();
      } else {
        $(".extra_storage").hide();
      }
    }

    $("#id_cpus").change(displayMoreCPUs);
    $("#id_storage").change(displayMoreStorage);
    displayMoreCPUs();
    displayMoreStorage();

});
</script>
{% endblock %}
